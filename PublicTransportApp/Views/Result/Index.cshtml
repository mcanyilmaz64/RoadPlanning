@model PublicTransportApp.Models.UserData.RouteViewModel

@{
    ViewBag.Title = "Rota Sonucu";
    Layout = "~/Views/Shared/UILayout.cshtml";
}

<div class="container mt-5 text-center">

    <h2 class="mb-4">Rota Bilgileri</h2>

    <div class="mb-3">
        <p><strong>Başlangıç:</strong> (@Model.StartLatitude, @Model.StartLongitude)</p>
        <p><strong>Hedef:</strong> (@Model.DestinationLatitude, @Model.DestinationLongitude)</p>
       
        <p><strong>Toplam Süre:</strong> @Model.TotalDuration dakika</p>
        <p><strong>Toplam Ücret:</strong> @Model.TotalFare ₺</p>

        @if (Model.EstimatedArrivalTime.HasValue)
        {
            <p><strong>Tahmini Varış Saati:</strong> @Model.EstimatedArrivalTime.Value.ToString(@"hh\:mm")</p>
        }
    </div>

    <hr class="my-4" />

    <h3 class="mb-3">Rota Üzerindeki Duraklar</h3>

    <ol class="list-unstyled">

        <!-- Başlangıçtan durağa erişim -->
        <li class="mb-4">
            <div class="p-3 border rounded bg-warning-subtle">
                <strong>Başlangıçtan İlk Durağa @Model.AccessType</strong><br />
                <small>
                    Süre: @((int)(Model.AccessType == "Taksi" ? Model.TotalDistance / 30.0 * 60 : Model.TotalDistance / 5.0 * 60)) dk |
                    Mesafe: @Model.TotalDistance.ToString("F2") km |
                    Ücret: @(Model.AccessType == "Taksi" ? (20 + Model.TotalDistance * 12).ToString("F2") : "0") ₺
                </small>
            </div>
        </li>

        <!-- Duraklar -->
        @for (int i = 0; i < Model.RouteNodes.Count; i++)
        {
            var currentNode = Model.RouteNodes[i];
            var nextNode = i < Model.RouteNodes.Count - 1 ? Model.RouteNodes[i + 1] : null;

            <li class="mb-4">
                <div class="p-3 border rounded bg-light">
                    <strong>@currentNode.Stop.Name</strong> <span class="text-muted">(Type: @currentNode.Stop.Type)</span><br />
                    <small>Koordinatlar: (@currentNode.Stop.Lat, @currentNode.Stop.Lon)</small>

                    @if (nextNode != null)
                    {
                        var edge = currentNode.Edges?.FirstOrDefault(e => e.To == nextNode);
                        if (edge != null)
                        {
                            <br />
                            <small class="text-muted">
                                Süre: @edge.Duration dk |
                                Ücret: @edge.Cost ₺ |
                                Mesafe: @edge.Distance.ToString("F2") km
                            </small>
                        }
                    }
                </div>
            </li>
        }


        <!-- Hedefe erişim -->
        <li class="mb-4">
            <div class="p-3 border rounded bg-info-subtle">
                <strong>Son Duraktan Hedefe @Model.DestinationAccessType</strong><br />
                <small>
                    Süre: @Model.DestinationAccessDuration.ToString("F0") dk |
                    Mesafe: @((Model.DestinationAccessDuration / 5.0).ToString("F2")) km |
                    Ücret: @Model.DestinationAccessFare.ToString("F2") ₺
                </small>
            </div>
        </li>

    </ol>


</div>
